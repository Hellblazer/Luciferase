# Documentation Validation Workflow
# Runs on pull requests to ensure documentation quality

name: Documentation Checks

on:
  pull_request:
    paths:
      - '**.md'
      - 'scripts/validate-documentation.sh'
      - '.github/workflows/documentation-checks.yml'
  push:
    branches:
      - main
    paths:
      - '**.md'

jobs:
  validate-docs:
    name: Validate Documentation
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: write
      pull-requests: write
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          
      - name: Install markdown tools
        run: |
          npm install -g markdownlint-cli
          npm install -g markdown-link-check
          
      - name: Run documentation validation
        run: |
          chmod +x scripts/validate-documentation.sh
          ./scripts/validate-documentation.sh
          
      - name: Check for broken links
        run: |
          # Check all markdown files for broken links
          find . -name "*.md" -not -path "*/node_modules/*" -not -path "*/.git/*" \
            -exec markdown-link-check --config .github/markdown-link-check-config.json {} \;
        
      - name: Lint markdown files
        run: |
          markdownlint '**/*.md' \
            --ignore node_modules \
            --ignore .git \
            --config .github/markdownlint-config.json
        
      - name: Comment PR with results
        if: github.event_name == 'pull_request'
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            
            // Create comment body
            let body = '## Documentation Validation Results\n\n';
            body += 'Documentation checks completed. ';
            body += 'Please review any warnings or errors above.\n\n';
            body += '### Checklist\n';
            body += '- [ ] All documentation headers updated with current date\n';
            body += '- [ ] No broken internal links\n';
            body += '- [ ] Standard terminology used (see DOCUMENTATION_STANDARDS.md)\n';
            body += '- [ ] Code examples are valid and compile\n';
            body += '- [ ] Performance claims include measurement context\n';
            
            // Post comment
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: body
            });
